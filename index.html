<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MyMap</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        body {
            background: black;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            font-family: system-ui, -apple-system, sans-serif;
        }
        /* –∫–∞—Ä—Ç–∞ –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω */
        .map-full {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #111;
            padding: 5px;
        }
        canvas {
            display: block;
            width: 100%;
            height: 100%;
            max-width: 100vw;
            max-height: 100vh;
            background: #222;
            image-rendering: crisp-edges;
        }
        /* –º–∏–Ω–∏–º—É–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ */
        .coords {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 8px 16px;
            border-radius: 30px;
            font-size: 1.3rem;
            font-weight: bold;
            z-index: 10;
        }
        .coords span {
            color: #ffd966;
            margin-left: 8px;
        }
        /* –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è ‚Äî –±–æ–ª—å—à–∏–µ, –≤ —Å–∞–º–æ–º –Ω–∏–∑—É */
        .controls {
            position: fixed;
            bottom: 20px;
            left: 0;
            right: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            z-index: 20;
            padding: 0 10px;
        }
        .btn-row {
            display: flex;
            gap: 20px;
            justify-content: center;
        }
        .move-btn {
            background: #333;
            border: 2px solid #666;
            color: white;
            font-size: 3.5rem;
            width: 100px;
            height: 100px;
            border-radius: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            touch-action: manipulation;
            box-shadow: 0 5px 0 #1a1a1a;
            transition: 0.05s;
        }
        .move-btn:active {
            transform: translateY(5px);
            box-shadow: none;
        }
        #newMapBtn {
            background: #333;
            border: 2px solid #666;
            color: white;
            font-size: 2rem;
            padding: 15px 30px;
            border-radius: 40px;
            margin-top: 10px;
            cursor: pointer;
            touch-action: manipulation;
        }
        @media (max-width: 500px) {
            .move-btn {
                width: 85px;
                height: 85px;
                font-size: 3rem;
            }
        }
    </style>
</head>
<body>
    <div class="coords">
        X: <span id="xC">0</span> Y: <span id="yC">0</span>
    </div>

    <div class="map-full">
        <canvas id="gameCanvas"></canvas>
    </div>

    <div class="controls">
        <div class="btn-row">
            <button class="move-btn" id="upBtn">‚¨ÜÔ∏è</button>
        </div>
        <div class="btn-row">
            <button class="move-btn" id="leftBtn">‚¨ÖÔ∏è</button>
            <button class="move-btn" id="downBtn">‚¨áÔ∏è</button>
            <button class="move-btn" id="rightBtn">‚û°Ô∏è</button>
        </div>
        <button id="newMapBtn">üîÑ –Ω–æ–≤–∞—è –∫–∞—Ä—Ç–∞</button>
    </div>

    <script>
        (function() {
            // ====== —Ä–∞–∑–º–µ—Ä—ã ======
            const SIZE = 100; // —Å–µ—Ç–∫–∞ 100x100
            let canvas = document.getElementById('gameCanvas');
            let ctx = canvas.context;

            // —ç–ª–µ–º–µ–Ω—Ç—ã –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
            let xDisplay = document.getElementById('xC');
            let yDisplay = document.getElementById('yC');

            // –∏–≥—Ä–æ–∫ –∏ —Å—Ç–µ–Ω—ã
            let player = { x: 50, y: 50 };
            let walls = [];

            // ====== –ø–æ–¥–≥–æ–Ω canvas –ø–æ–¥ —Ä–∞–∑–º–µ—Ä —ç–∫—Ä–∞–Ω–∞ ======
            function resizeCanvas() {
                let container = document.querySelector('.map-full');
                let w = container.clientWidth;
                let h = container.clientHeight;
                canvas.width = w;
                canvas.height = h;
                draw(); // –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞
            }

            // ====== –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ç–µ–Ω ======
            function generateMap() {
                let newWalls = [];
                let count = 1500 + Math.floor(Math.random() * 500); // ~1500-2000 —Å—Ç–µ–Ω

                for (let i = 0; i < count; i++) {
                    newWalls.push({
                        x: Math.floor(Math.random() * SIZE),
                        y: Math.floor(Math.random() * SIZE)
                    });
                }

                // —Å–ª—É—á–∞–π–Ω—ã–π —Å—Ç–∞—Ä—Ç (–Ω–µ –≤ —Å—Ç–µ–Ω–µ)
                let startX, startY;
                do {
                    startX = Math.floor(Math.random() * SIZE);
                    startY = Math.floor(Math.random() * SIZE);
                } while (newWalls.some(w => w.x === startX && w.y === startY));

                player.x = startX;
                player.y = startY;

                // —É–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã –∏ —Å—Ç–µ–Ω—ã –Ω–∞ –∫–ª–µ—Ç–∫–µ –∏–≥—Ä–æ–∫–∞
                let unique = new Map();
                for (let w of newWalls) {
                    if (w.x === player.x && w.y === player.y) continue;
                    unique.set(w.x + ',' + w.y, { x: w.x, y: w.y });
                }
                walls = Array.from(unique.values());
            }

            // ====== –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–µ–Ω—ã ======
            function isWall(x, y) {
                for (let i = 0; i < walls.length; i++) {
                    if (walls[i].x === x && walls[i].y === y) return true;
                }
                return false;
            }

            // ====== –¥–≤–∏–∂–µ–Ω–∏–µ ======
            function tryMove(dx, dy) {
                let nx = player.x + dx;
                let ny = player.y + dy;
                if (nx < 0 || nx >= SIZE || ny < 0 || ny >= SIZE) return false;
                if (isWall(nx, ny)) return false;
                player.x = nx;
                player.y = ny;
                return true;
            }

            // ====== –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ (–º–∏–Ω–∏–º—É–º, —Ç–æ–ª—å–∫–æ —Å—É—Ç—å) ======
            function draw() {
                if (!canvas || !ctx) return;

                let w = canvas.width;
                let h = canvas.height;

                // –∑–∞–ª–∏–≤–∫–∞ —Ñ–æ–Ω–∞ (—Ç—ë–º–Ω–æ-—Å–µ—Ä—ã–π)
                ctx.fillStyle = '#1a1a1a';
                ctx.fillRect(0, 0, w, h);

                // —Ä–∞–∑–º–µ—Ä –∫–ª–µ—Ç–∫–∏, —á—Ç–æ–±—ã –ø–æ–ª–µ 100x100 –≤–ª–µ–∑–ª–æ –≤ —ç–∫—Ä–∞–Ω
                let cellSize = Math.min(w, h) / SIZE;

                // —Å–º–µ—â–µ–Ω–∏–µ, —á—Ç–æ–±—ã –æ—Ç—Ü–µ–Ω—Ç—Ä–æ–≤–∞—Ç—å —Å–µ—Ç–∫—É
                let offsetX = (w - cellSize * SIZE) / 2;
                let offsetY = (h - cellSize * SIZE) / 2;

                // —Ä–∏—Å—É–µ–º —Å—Ç–µ–Ω—ã (—á—ë—Ä–Ω—ã–µ –∫–≤–∞–¥—Ä–∞—Ç—ã)
                ctx.fillStyle = '#333';
                for (let i = 0; i < walls.length; i++) {
                    let wx = walls[i].x;
                    let wy = walls[i].y;
                    ctx.fillRect(
                        offsetX + wx * cellSize,
                        offsetY + wy * cellSize,
                        cellSize * 0.95, // —á—É—Ç—å –º–µ–Ω—å—à–µ –¥–ª—è –∑–∞–∑–æ—Ä–∞
                        cellSize * 0.95
                    );
                }

                // —Ä–∏—Å—É–µ–º –∏–≥—Ä–æ–∫–∞ (–∫—Ä—É–ø–Ω—ã–π —Å–≤–µ—Ç–ª—ã–π –∫—Ä—É–≥)
                ctx.fillStyle = '#f0f0f0';
                ctx.shadowColor = '#aaa';
                ctx.shadowBlur = 10;
                ctx.beginPath();
                ctx.arc(
                    offsetX + player.x * cellSize + cellSize/2,
                    offsetY + player.y * cellSize + cellSize/2,
                    cellSize * 0.4, // –∫—Ä—É–ø–Ω—ã–π
                    0, 2 * Math.PI
                );
                ctx.fill();
                ctx.shadowBlur = 0;

                // –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
                xDisplay.textContent = player.x;
                yDisplay.textContent = player.y;
            }

            // ====== –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–≤–∏–∂–µ–Ω–∏—è ======
            function moveUp() { tryMove(0, -1); draw(); }
            function moveDown() { tryMove(0, 1); draw(); }
            function moveLeft() { tryMove(-1, 0); draw(); }
            function moveRight() { tryMove(1, 0); draw(); }
            function newMap() { generateMap(); draw(); }

            // ====== –Ω–∞–≤–µ—à–∏–≤–∞–µ–º —Å–æ–±—ã—Ç–∏—è ======
            document.getElementById('upBtn').addEventListener('click', (e) => {
                e.preventDefault();
                moveUp();
            });
            document.getElementById('downBtn').addEventListener('click', (e) => {
                e.preventDefault();
                moveDown();
            });
            document.getElementById('leftBtn').addEventListener('click', (e) => {
                e.preventDefault();
                moveLeft();
            });
            document.getElementById('rightBtn').addEventListener('click', (e) => {
                e.preventDefault();
                moveRight();
            });
            document.getElementById('newMapBtn').addEventListener('click', (e) => {
                e.preventDefault();
                newMap();
            });

            // —Ç–∞—á-—Å–æ–±—ã—Ç–∏—è —á—Ç–æ–±—ã –Ω–µ —Å–∫—Ä–æ–ª–ª–∏–ª–æ—Å—å
            let btns = document.querySelectorAll('button');
            btns.forEach(btn => {
                btn.addEventListener('touchstart', (e) => e.preventDefault());
            });

            // –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞
            window.addEventListener('keydown', (e) => {
                if (e.target.tagName === 'INPUT') return;
                switch(e.key) {
                    case 'ArrowUp': e.preventDefault(); moveUp(); break;
                    case 'ArrowDown': e.preventDefault(); moveDown(); break;
                    case 'ArrowLeft': e.preventDefault(); moveLeft(); break;
                    case 'ArrowRight': e.preventDefault(); moveRight(); break;
                }
            });

            // —Ä–µ—Å–∞–π–∑ –æ–∫–Ω–∞
            window.addEventListener('resize', () => {
                resizeCanvas();
            });

            // —Å—Ç–∞—Ä—Ç
            generateMap();
            // –Ω—É–∂–µ–Ω context –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ä–∞–∑–º–µ—Ä–∞
            setTimeout(() => {
                ctx = canvas.getContext('2d');
                resizeCanvas();
            }, 10);
        })();
    </script>
</body>
</html>