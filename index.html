<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MyMap ‚Äî —Ç–≤–æ—è –∫–∞—Ä—Ç–∞</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: #3a2c1f; /* —Ç—ë–º–Ω—ã–π —Ñ–æ–Ω –≤–æ–∫—Ä—É–≥ */
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Courier New', Courier, monospace;
            padding: 8px;
        }

        .game {
            max-width: 380px;
            width: 100%;
            background: #7d5e3f; /* –±–µ–∂–µ–≤–æ-–∫–æ—Ä–∏—á–Ω–µ–≤—ã–π —Ñ–æ–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ */
            border-radius: 24px;
            padding: 20px 12px 24px;
            box-shadow: 0 12px 0 #4f3a25;
        }

        /* –∫–∞—Ä—Ç–∞ ‚Äî –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç */
        .map-container {
            background: #4f3a25;
            padding: 10px;
            border-radius: 28px;
            margin-bottom: 20px;
            box-shadow: inset 0 4px 0 #2f2319;
        }

        canvas {
            display: block;
            width: 100%;
            height: auto;
            background: #dac29c; /* –±–µ–∂–µ–≤—ã–π —Ñ–æ–Ω –∫–∞—Ä—Ç—ã */
            border-radius: 20px;
            box-shadow: 0 6px 0 #3d2e1d;
            image-rendering: crisp-edges;
        }

        /* –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã ‚Äî –º–∏–Ω–∏–º–∞–ª–∏–∑–º */
        .pos {
            display: flex;
            justify-content: space-between;
            background: #8b6e4b;
            color: #f0dec0;
            padding: 12px 18px;
            border-radius: 40px;
            font-weight: bold;
            font-size: 1.4rem;
            margin-bottom: 20px;
            border: 2px solid #4f3a25;
            box-shadow: inset 0 2px 5px #3e2e1b;
        }

        .pos span {
            background: #2f2319;
            padding: 6px 20px;
            border-radius: 40px;
            color: #ecd8b4;
        }

        /* –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è ‚Äî –æ–≥—Ä–æ–º–Ω—ã–µ, —á—ë—Ç–∫–æ –∫–ª–∏–∫–∞—é—Ç—Å—è */
        .arrows {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .row {
            display: flex;
            gap: 18px;
            justify-content: center;
        }

        .ctrl-btn {
            background: #b48c5c; /* –±–µ–∂–µ–≤–æ-–∫–æ—Ä–∏—á–Ω–µ–≤–∞—è */
            border: none;
            color: #2f2319;
            font-size: 3.4rem;
            font-weight: bold;
            width: 100px;
            height: 100px;
            border-radius: 40px;
            box-shadow: 0 8px 0 #5d412b, 0 8px 15px rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            touch-action: manipulation;
            transition: all 0.06s;
            line-height: 1;
            border: 2px solid #3d2e1b;
        }

        .ctrl-btn:active {
            transform: translateY(8px);
            box-shadow: 0 2px 0 #5d412b;
        }

        /* –∫–Ω–æ–ø–∫–∞ –Ω–æ–≤–æ–π –∫–∞—Ä—Ç—ã */
        .new-map {
            background: #5d412b;
            border: none;
            color: #f7e9d2;
            font-size: 1.6rem;
            font-weight: bold;
            padding: 16px 28px;
            border-radius: 60px;
            box-shadow: 0 7px 0 #342216;
            margin: 16px auto 8px;
            width: fit-content;
            cursor: pointer;
            touch-action: manipulation;
            border: 2px solid #8b6e4b;
            transition: all 0.06s;
        }

        .new-map:active {
            transform: translateY(6px);
            box-shadow: 0 1px 0 #342216;
        }

        .footer {
            text-align: center;
            color: #ecd8b4;
            font-size: 0.9rem;
            margin-top: 12px;
        }

        /* –º–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è */
        @media (max-width: 400px) {
            .ctrl-btn {
                width: 85px;
                height: 85px;
                font-size: 3rem;
            }
        }
    </style>
</head>
<body>
<div class="game">
    <div class="pos">
        <span>üó∫Ô∏è X</span> <span id="xVal">0</span> <span style="margin-left: 10px;">Y</span> <span id="yVal">0</span>
    </div>

    <div class="map-container">
        <canvas id="mapCanvas" width="400" height="600"></canvas>
    </div>

    <div class="arrows">
        <div class="row">
            <button class="ctrl-btn" id="goUp" aria-label="–≤–≤–µ—Ä—Ö">‚¨ÜÔ∏è</button>
        </div>
        <div class="row">
            <button class="ctrl-btn" id="goLeft" aria-label="–≤–ª–µ–≤–æ">‚¨ÖÔ∏è</button>
            <button class="ctrl-btn" id="goDown" aria-label="–≤–Ω–∏–∑">‚¨áÔ∏è</button>
            <button class="ctrl-btn" id="goRight" aria-label="–≤–ø—Ä–∞–≤–æ">‚û°Ô∏è</button>
        </div>
    </div>

    <div style="display: flex; justify-content: center;">
        <button class="new-map" id="generateBtn">üîÑ –Ω–æ–≤–∞—è</button>
    </div>
    <div class="footer">MyMap ¬∑ —à–∞–≥ 1 ¬∑ —Å—Ç–µ–Ω—ã</div>
</div>

<script>
    (function() {
        // ---------- —Ä–∞–∑–º–µ—Ä—ã ----------
        const SIZE = 100;               // –ø–æ–ª–µ 100x100
        const CANVAS_W = 400;
        const CANVAS_H = 600;
        const CELL_SIZE = 4;            // 400/100 = 4 (—à–∏—Ä–∏–Ω–∞ —è—á–µ–π–∫–∏)
        // –Ω–æ —Ç–∞–∫ –∫–∞–∫ –≤—ã—Å–æ—Ç–∞ canvas 600, —Ä–∏—Å—É–µ–º –∫–≤–∞–¥—Ä–∞—Ç—ã 4x6? –Ω–µ—Ç ‚Äî —Å–æ—Ö—Ä–∞–Ω–∏–º –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏: —à–∏—Ä–∏–Ω–∞ 4, –≤—ã—Å–æ—Ç–∞ 4 (–ø–∏–∫—Å–µ–ª–∏ –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ)
        // –ø—Ä–æ—Å—Ç–æ –æ—Ç—Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ (—Å–≤–µ—Ä—Ö—É –∏ —Å–Ω–∏–∑—É –±—É–¥—É—Ç –ø–æ–ª—è)
        const Y_OFFSET = (CANVAS_H - SIZE * CELL_SIZE) / 2; // (600 - 400)/2 = 100px —Å–≤–µ—Ä—Ö—É/—Å–Ω–∏–∑—É

        const canvas = document.getElementById('mapCanvas');
        const ctx = canvas.getContext('2d');

        const xSpan = document.getElementById('xVal');
        const ySpan = document.getElementById('yVal');

        // –∏–≥—Ä–æ–∫ –∏ —Å—Ç–µ–Ω—ã
        let player = { x: 50, y: 50 };
        let walls = [];

        // ---------- –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞—Ä—Ç—ã (—Å—Ç–µ–Ω—ã + –ø–æ–∑–∏—Ü–∏—è) ----------
        function generateMap() {
            const newWalls = [];
            const wallCount = 1400 + Math.floor(Math.random() * 400); // ~1500-1800 —Å—Ç–µ–Ω

            for (let i = 0; i < wallCount; i++) {
                newWalls.push({
                    x: Math.floor(Math.random() * SIZE),
                    y: Math.floor(Math.random() * SIZE)
                });
            }

            // —Å–ª—É—á–∞–π–Ω—ã–π —Å—Ç–∞—Ä—Ç (–Ω–µ —Å—Ç–µ–Ω–∞)
            let startX, startY;
            do {
                startX = Math.floor(Math.random() * SIZE);
                startY = Math.floor(Math.random() * SIZE);
            } while (newWalls.some(w => w.x === startX && w.y === startY));

            player.x = startX;
            player.y = startY;

            // —É–¥–∞–ª—è–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã –∏ —É–±–∏—Ä–∞–µ–º —Å—Ç–µ–Ω—ã –Ω–∞ –∫–ª–µ—Ç–∫–µ –∏–≥—Ä–æ–∫–∞
            const unique = new Map(); // –∏—Å–ø–æ–ª—å–∑—É–µ–º Map –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –¥—É–±–ª–µ–π
            for (const w of newWalls) {
                if (w.x === player.x && w.y === player.y) continue; // –Ω–µ —Å—Ç–∞–≤–∏–º —Å—Ç–µ–Ω—É –Ω–∞ –∏–≥—Ä–æ–∫–∞
                unique.set(`${w.x},${w.y}`, { x: w.x, y: w.y });
            }
            walls = Array.from(unique.values());
        }

        // –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–µ–Ω—ã
        function isWall(x, y) {
            // –±—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ some, –Ω–æ walls.length ~1700 ‚Äî –Ω–æ—Ä–º
            return walls.some(w => w.x === x && w.y === y);
        }

        // –¥–≤–∏–∂–µ–Ω–∏–µ
        function tryMove(dx, dy) {
            const nx = player.x + dx;
            const ny = player.y + dy;
            if (nx < 0 || nx >= SIZE || ny < 0 || ny >= SIZE) return false;
            if (isWall(nx, ny)) return false;
            player.x = nx;
            player.y = ny;
            return true;
        }

        // –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ (–±–µ–∂–µ–≤–æ-–∫–æ—Ä–∏—á–Ω–µ–≤–æ-—á–µ—Ä–Ω–∞—è –≥–∞–º–º–∞)
        function draw() {
            ctx.clearRect(0, 0, CANVAS_W, CANVAS_H);

            // —Ñ–æ–Ω –∫–∞—Ä—Ç—ã (–±–µ–∂–µ–≤—ã–π)
            ctx.fillStyle = '#dac29c';
            ctx.fillRect(0, 0, CANVAS_W, CANVAS_H);

            // —Å—Ç–µ–Ω—ã ‚Äî —Ç—ë–º–Ω–æ-–∫–æ—Ä–∏—á–Ω–µ–≤—ã–µ (–ø–æ—á—Ç–∏ —á—ë—Ä–Ω—ã–µ)
            ctx.fillStyle = '#3a2c1f';
            for (const w of walls) {
                ctx.fillRect(
                    w.x * CELL_SIZE,
                    Y_OFFSET + w.y * CELL_SIZE,
                    CELL_SIZE - 0.3,  // —á—É—Ç—å –º–µ–Ω—å—à–µ –¥–ª—è –∑–∞–∑–æ—Ä–∞
                    CELL_SIZE - 0.3
                );
            }

            // –∏–≥—Ä–æ–∫ ‚Äî –∫—Ä—É–ø–Ω—ã–π –æ—Ä–∞–Ω–∂–µ–≤–æ-–±–µ–∂–µ–≤—ã–π –º—è—á–∏–∫
            ctx.fillStyle = '#e3b17b';
            ctx.shadowColor = '#8b5a2b';
            ctx.shadowBlur = 8;
            ctx.beginPath();
            ctx.arc(
                player.x * CELL_SIZE + CELL_SIZE/2,
                Y_OFFSET + player.y * CELL_SIZE + CELL_SIZE/2,
                CELL_SIZE/1.6,  // –∫—Ä—É–ø–Ω–µ–µ (–≤–º–µ—Å—Ç–æ /2 –¥–µ–ª–∞–µ–º /1.6)
                0, 2 * Math.PI
            );
            ctx.fill();
            ctx.shadowBlur = 0;
            ctx.shadowColor = 'transparent';

            // –ª—ë–≥–∫–∞—è —Å–µ—Ç–∫–∞ (–ø–æ—á—Ç–∏ –Ω–µ–∑–∞–º–µ—Ç–Ω–∞)
            ctx.strokeStyle = '#b48c5c';
            ctx.lineWidth = 0.3;
            for (let i = 0; i <= SIZE; i++) {
                ctx.beginPath();
                ctx.moveTo(i * CELL_SIZE, Y_OFFSET);
                ctx.lineTo(i * CELL_SIZE, Y_OFFSET + SIZE * CELL_SIZE);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(0, Y_OFFSET + i * CELL_SIZE);
                ctx.lineTo(SIZE * CELL_SIZE, Y_OFFSET + i * CELL_SIZE);
                ctx.stroke();
            }

            // –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
            xSpan.textContent = player.x;
            ySpan.textContent = player.y;
        }

        // –¥–µ–π—Å—Ç–≤–∏–µ + –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞
        function moveAndDraw(dx, dy) {
            tryMove(dx, dy);
            draw();
        }

        // –Ω–æ–≤–∞—è –∫–∞—Ä—Ç–∞
        function newMap() {
            generateMap();
            draw();
        }

        // ---------- –ü–û–î–ü–ò–°–ö–ê –ù–ê –ö–ù–û–ü–ö–ò (—Ä–∞–±–æ—á–∏–µ) ----------
        document.getElementById('goUp').addEventListener('click', function(e) {
            e.preventDefault();
            moveAndDraw(0, -1);
        });
        document.getElementById('goDown').addEventListener('click', function(e) {
            e.preventDefault();
            moveAndDraw(0, 1);
        });
        document.getElementById('goLeft').addEventListener('click', function(e) {
            e.preventDefault();
            moveAndDraw(-1, 0);
        });
        document.getElementById('goRight').addEventListener('click', function(e) {
            e.preventDefault();
            moveAndDraw(1, 0);
        });
        document.getElementById('generateBtn').addEventListener('click', function(e) {
            e.preventDefault();
            newMap();
        });

        // –º–æ–±–∏–ª—å–Ω—ã–π touchstart —á—Ç–æ–±—ã –Ω–µ —Å–∫—Ä–æ–ª–ª–∏–ª–æ
        const allBtns = document.querySelectorAll('button');
        allBtns.forEach(btn => {
            btn.addEventListener('touchstart', (e) => e.preventDefault());
        });

        // –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ)
        window.addEventListener('keydown', (e) => {
            if (e.target.tagName === 'INPUT') return;
            switch(e.key) {
                case 'ArrowUp': e.preventDefault(); moveAndDraw(0, -1); break;
                case 'ArrowDown': e.preventDefault(); moveAndDraw(0, 1); break;
                case 'ArrowLeft': e.preventDefault(); moveAndDraw(-1, 0); break;
                case 'ArrowRight': e.preventDefault(); moveAndDraw(1, 0); break;
            }
        });

        // —Å—Ç–∞—Ä—Ç
        generateMap();
        draw();
    })();
</script>
</body>
</html>