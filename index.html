<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–õ–∞–±–∏—Ä–∏–Ω—Ç: 100 —à–∞–≥–æ–≤</title>
    <style>
        * {
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        body {
            margin: 0;
            min-height: 100vh;
            background: #1a2a32;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: system-ui, -apple-system, sans-serif;
            padding: 8px;
        }
        .game-container {
            background: #0f1a1f;
            border-radius: 28px;
            padding: 20px 16px 24px;
            box-shadow: 0 10px 0 #0b1318;
            max-width: 500px;
            width: 100%;
        }
        .stats {
            display: flex;
            justify-content: space-between;
            color: #bcd4de;
            background: #1f2e38;
            padding: 10px 16px;
            border-radius: 40px;
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 18px;
            box-shadow: inset 0 2px 3px #0d181e;
        }
        .coord span {
            color: #f4e9be;
            background: #0b171f;
            padding: 4px 10px;
            border-radius: 24px;
            margin-left: 6px;
        }
        .canvas-wrapper {
            display: flex;
            justify-content: center;
            margin-bottom: 18px;
            background: #17242b;
            padding: 12px;
            border-radius: 36px;
            box-shadow: inset 0 0 0 2px #263b45;
        }
        canvas {
            display: block;
            width: 100%;
            height: auto;
            max-width: 400px;
            aspect-ratio: 1/1;
            background: #1e2f38;
            border-radius: 24px;
            box-shadow: 0 6px 0 #0c171e;
            image-rendering: crisp-edges; /* –¥–ª—è —á—ë—Ç–∫–∏—Ö –∫–≤–∞–¥—Ä–∞—Ç–æ–≤ */
        }
        .control-panel {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
        }
        .row {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        .btn {
            background: #314b58;
            border: none;
            color: white;
            font-size: 2.8rem;
            font-weight: bold;
            width: 90px;
            height: 90px;
            border-radius: 40px;
            box-shadow: 0 7px 0 #1b2c35, 0 10px 15px rgba(0,0,0,0.4);
            transition: all 0.04s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            touch-action: manipulation;
            line-height: 1;
            -webkit-tap-highlight-color: transparent;
        }
        .btn:active {
            transform: translateY(6px);
            box-shadow: 0 2px 0 #1b2c35;
        }
        @media (max-width: 450px) {
            .btn {
                width: 75px;
                height: 75px;
                font-size: 2.4rem;
                border-radius: 35px;
            }
        }
        .new-map-btn {
            background: #3f5e6b;
            color: white;
            border: none;
            font-size: 1.3rem;
            font-weight: 600;
            padding: 16px 24px;
            border-radius: 50px;
            box-shadow: 0 6px 0 #22323d;
            margin-top: 18px;
            width: fit-content;
            cursor: pointer;
            transition: all 0.06s;
            letter-spacing: 0.5px;
            touch-action: manipulation;
        }
        .new-map-btn:active {
            transform: translateY(5px);
            box-shadow: 0 1px 0 #22323d;
        }
        .footer-note {
            color: #5f7e8b;
            font-size: 0.8rem;
            text-align: center;
            margin-top: 14px;
        }
    </style>
</head>
<body>
<div class="game-container">
    <div class="stats">
        <div class="coord">üìå X: <span id="xCoord">0</span></div>
        <div class="coord">üìå Y: <span id="yCoord">0</span></div>
    </div>

    <div class="canvas-wrapper">
        <canvas id="gameCanvas" width="400" height="400"></canvas>
    </div>

    <div class="control-panel">
        <div class="row">
            <button class="btn" id="moveUp" aria-label="–≤–≤–µ—Ä—Ö">‚¨ÜÔ∏è</button>
        </div>
        <div class="row">
            <button class="btn" id="moveLeft" aria-label="–≤–ª–µ–≤–æ">‚¨ÖÔ∏è</button>
            <button class="btn" id="moveDown" aria-label="–≤–Ω–∏–∑">‚¨áÔ∏è</button>
            <button class="btn" id="moveRight" aria-label="–≤–ø—Ä–∞–≤–æ">‚û°Ô∏è</button>
        </div>
    </div>

    <div style="display: flex; justify-content: center;">
        <button class="new-map-btn" id="newMapBtn">üîÑ –Ω–æ–≤–∞—è –∫–∞—Ä—Ç–∞</button>
    </div>
    <div class="footer-note">‚ö° —à–∞–≥ = 1 | —Å—Ç–µ–Ω—ã –Ω–µ –ø—É—Å–∫–∞—é—Ç</div>
</div>

<script>
    (function() {
        // ----- —Ä–∞–∑–º–µ—Ä—ã -----
        const SIZE = 100;            // –ø–æ–ª–µ 100x100
        const CELL_SIZE = 4;          // 400 / 100 = 4 –ø–∏–∫—Å–µ–ª—è –Ω–∞ –∫–ª–µ—Ç–∫—É

        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // —ç–ª–µ–º–µ–Ω—Ç—ã –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
        const xSpan = document.getElementById('xCoord');
        const ySpan = document.getElementById('yCoord');

        // --- –∏–≥—Ä–æ–∫ –∏ –∫–∞—Ä—Ç–∞ ---
        let player = { x: 50, y: 50 };   // –≤—Ä–µ–º–µ–Ω–Ω–æ, –ø–æ—Ç–æ–º –ø–µ—Ä–µ–∑–∞–ø–∏—à–µ–º random
        let walls = [];                   // –º–∞—Å—Å–∏–≤ —Å—Ç–µ–Ω: –∫–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç {x, y}

        // ---- –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω–æ–π –∫–∞—Ä—Ç—ã (–≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º –ø—Ä–æ—Ö–æ–¥–∏–º–æ—Å—Ç—å —Å—Ç–∞—Ä—Ç–æ–≤–æ–π –ø–æ–∑–∏—Ü–∏–∏) ----
        function generateMap() {
            // 1. —Å–æ–∑–¥–∞—ë–º –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ —Å—Ç–µ–Ω
            const newWalls = [];

            // 2. –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º ~1500 —Å—Ç–µ–Ω (–ø—Ä–∏–º–µ—Ä–Ω–æ 15% –æ—Ç 10000 –∫–ª–µ—Ç–æ–∫)
            const wallCount = 1400 + Math.floor(Math.random() * 300); // 1400..1700

            for (let i = 0; i < wallCount; i++) {
                const wx = Math.floor(Math.random() * SIZE);
                const wy = Math.floor(Math.random() * SIZE);
                // –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç –Ω–µ –¥–µ–ª–∞–µ–º —Ä–∞–¥–∏ —Å–∫–æ—Ä–æ—Å—Ç–∏ ‚Äî —Ä–µ–¥–∫–∏–µ –ø–æ–≤—Ç–æ—Ä—ã –¥–æ–ø—É—Å—Ç–∏–º—ã (—Å—Ç–µ–Ω–∞ –∏ –µ—Å—Ç—å —Å—Ç–µ–Ω–∞)
                newWalls.push({ x: wx, y: wy });
            }

            // 3. —Å–ª—É—á–∞–π–Ω–∞—è —Å—Ç–∞—Ä—Ç–æ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è –∏–≥—Ä–æ–∫–∞
            let startX, startY;
            do {
                startX = Math.floor(Math.random() * SIZE);
                startY = Math.floor(Math.random() * SIZE);
                // —É–±–µ–¥–∏–º—Å—è —á—Ç–æ —Å—Ç–∞—Ä—Ç–æ–≤–∞—è –∫–ª–µ—Ç–∫–∞ –Ω–µ —Å—Ç–µ–Ω–∞
            } while (newWalls.some(w => w.x === startX && w.y === startY));

            player.x = startX;
            player.y = startY;

            // 4. —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç–µ–Ω—ã (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: —É–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã, –µ—Å–ª–∏ –≤–¥—Ä—É–≥)
            // –ø—Ä–æ—â–µ –≤—Å–µ–≥–æ —á–µ—Ä–µ–∑ Set (–¥–ª—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏)
            const uniqueWalls = [];
            const seen = new Set();
            for (const w of newWalls) {
                const key = `${w.x},${w.y}`;
                if (!seen.has(key) && !(w.x === player.x && w.y === player.y)) { // –∏—Å–∫–ª—é—á–∞–µ–º —Å—Ç–∞—Ä—Ç–æ–≤—É—é –∫–ª–µ—Ç–∫—É –∏–∑ —Å—Ç–µ–Ω
                    seen.add(key);
                    uniqueWalls.push({ x: w.x, y: w.y });
                }
            }
            walls = uniqueWalls;
        }

        // --- –ø—Ä–æ–≤–µ—Ä–∫–∞, –∑–∞–Ω—è—Ç–∞ –ª–∏ –∫–ª–µ—Ç–∫–∞ —Å—Ç–µ–Ω–æ–π ---
        function isWall(x, y) {
            // –±—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ some (–¥–ª—è 1500-2000 —Å—Ç–µ–Ω –æ–∫)
            return walls.some(w => w.x === x && w.y === y);
        }

        // --- –¥–≤–∏–∂–µ–Ω–∏–µ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π ---
        function tryMove(dx, dy) {
            const newX = player.x + dx;
            const newY = player.y + dy;

            // –≥—Ä–∞–Ω–∏—Ü—ã
            if (newX < 0 || newX >= SIZE || newY < 0 || newY >= SIZE) {
                return false; // –∑–∞ –∫—Ä–∞–π –Ω–µ–ª—å–∑—è
            }

            // —Å—Ç–µ–Ω–∞?
            if (isWall(newX, newY)) {
                return false;
            }

            // –¥–≤–∏–≥–∞–µ–º
            player.x = newX;
            player.y = newY;
            return true;
        }

        // --- –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ (–º–∏–Ω–∏–º–∞–ª–∏–∑–º, –±–µ–∑ –ª–∞–≥–æ–≤) ---
        function draw() {
            ctx.clearRect(0, 0, 400, 400);

            // —Ñ–æ–Ω (–ø—Ä–æ—Ö–æ–¥–∏–º—ã–µ –∫–ª–µ—Ç–∫–∏)
            ctx.fillStyle = '#2d4a56';
            ctx.fillRect(0, 0, 400, 400);

            // —Ä–∏—Å—É–µ–º —Å—Ç–µ–Ω—ã ‚Äî —Ç—ë–º–Ω–æ-—Å–µ—Ä—ã–µ –∫–∏—Ä–ø–∏—á–∏
            ctx.fillStyle = '#1d2c35';
            for (const w of walls) {
                ctx.fillRect(w.x * CELL_SIZE, w.y * CELL_SIZE, CELL_SIZE-0.5, CELL_SIZE-0.5); // –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–∑–æ—Ä –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏
            }

            // –∏–≥—Ä–æ–∫ ‚Äî —è—Ä–∫–∏–π, –æ—Ä–∞–Ω–∂–µ–≤—ã–π
            ctx.fillStyle = '#f5b17b';
            ctx.shadowColor = '#e08e4b';
            ctx.shadowBlur = 6;
            ctx.beginPath();
            ctx.arc(
                player.x * CELL_SIZE + CELL_SIZE/2,
                player.y * CELL_SIZE + CELL_SIZE/2,
                CELL_SIZE/2 - 0.5, 0, 2 * Math.PI
            );
            ctx.fill();
            ctx.shadowBlur = 0; // —Å–±—Ä–æ—Å —Ç–µ–Ω–∏

            // –Ω–µ–±–æ–ª—å—à–∞—è —Å–µ—Ç–∫–∞ –¥–ª—è –æ—Ä–∏–µ–Ω—Ç–∏—Ä–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø–æ—á—Ç–∏ –Ω–µ–∑–∞–º–µ—Ç–Ω–∞)
            ctx.strokeStyle = '#355763';
            ctx.lineWidth = 0.3;
            for (let i = 0; i <= SIZE; i++) {
                ctx.beginPath();
                ctx.strokeStyle = '#2a414d';
                ctx.lineWidth = 0.3;
                ctx.moveTo(i * CELL_SIZE, 0);
                ctx.lineTo(i * CELL_SIZE, 400);
                ctx.stroke();
                ctx.moveTo(0, i * CELL_SIZE);
                ctx.lineTo(400, i * CELL_SIZE);
                ctx.stroke();
            }

            // –æ–±–Ω–æ–≤–ª—è–µ–º —Ü–∏—Ñ—Ä—ã –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
            xSpan.textContent = player.x;
            ySpan.textContent = player.y;
        }

        // --- –æ–±–Ω–æ–≤–∏—Ç—å –ø–æ—Å–ª–µ –¥–≤–∏–∂–µ–Ω–∏—è ---
        function moveAndDraw(dx, dy) {
            tryMove(dx, dy);
            draw();
        }

        // --- –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞ ---
        function regenerateAndDraw() {
            generateMap();
            draw();
        }

        // --- –ø—Ä–∏–≤—è–∑–∫–∞ –∫–Ω–æ–ø–æ–∫ (—Ç–∞—á –∏ –º—ã—à—å) ---
        document.getElementById('moveUp').addEventListener('click', (e) => {
            e.preventDefault();
            moveAndDraw(0, -1);
        });
        document.getElementById('moveDown').addEventListener('click', (e) => {
            e.preventDefault();
            moveAndDraw(0, 1);
        });
        document.getElementById('moveLeft').addEventListener('click', (e) => {
            e.preventDefault();
            moveAndDraw(-1, 0);
        });
        document.getElementById('moveRight').addEventListener('click', (e) => {
            e.preventDefault();
            moveAndDraw(1, 0);
        });

        document.getElementById('newMapBtn').addEventListener('click', (e) => {
            e.preventDefault();
            regenerateAndDraw();
        });

        // ---- –∑–∞–ø—Ä–µ—Ç —Å–∫—Ä–æ–ª–ª–∞ –ø—Ä–∏ —Ç–∞—á–µ –Ω–∞ –∫–Ω–æ–ø–∫–∞—Ö (–¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö) ----
        const buttons = document.querySelectorAll('button');
        buttons.forEach(btn => {
            btn.addEventListener('touchstart', (e) => {
                e.preventDefault();
            });
        });

        // ---- —Å—Ç–∞—Ä—Ç ----
        generateMap();   // —Å–ª—É—á–∞–π–Ω—ã–π –∏–≥—Ä–æ–∫ –∏ —Å—Ç–µ–Ω—ã
        draw();

        // –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: –∫–ª–∞–≤–∏—à–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã (–¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞)
        window.addEventListener('keydown', (e) => {
            // —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ –≤–≤–æ–¥ –≤ –ø–æ–ª–µ (—É –Ω–∞—Å –ø–æ–ª–µ–π –Ω–µ—Ç, –Ω–æ –Ω–∞ –≤—Å—è–∫–∏–π)
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
            switch (e.key) {
                case 'ArrowUp': e.preventDefault(); moveAndDraw(0, -1); break;
                case 'ArrowDown': e.preventDefault(); moveAndDraw(0, 1); break;
                case 'ArrowLeft': e.preventDefault(); moveAndDraw(-1, 0); break;
                case 'ArrowRight': e.preventDefault(); moveAndDraw(1, 0); break;
                default:;
            }
        });
    })();
</script>
</body>
</html>
